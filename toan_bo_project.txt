
====================
FILE: .\app.py
====================
from flask import Flask
from routes.auth import auth_bp
from routes.benh_nhan import benh_nhan_bp
from routes.bac_si import bac_si_bp
from routes.public import public_bp
app = Flask(__name__)
app.secret_key = "06081983"
app.register_blueprint(auth_bp)
app.register_blueprint(benh_nhan_bp)
app.register_blueprint(bac_si_bp)
app.register_blueprint(public_bp)

if __name__ == "__main__":
    app.run(debug=True)

====================
FILE: .\db.py
====================
import pymysql
def get_connection():
    conn = pymysql.connect(
        host="localhost",
        user="root",
        password="",
        database="clinic_db",
        cursorclass=pymysql.cursors.DictCursor
    )
    return conn

====================
FILE: .\database\schema.sql
====================
CREATE TABLE IF NOT EXISTS TAI_KHOAN (
    AccountID INT AUTO_INCREMENT PRIMARY KEY,
    TenDangNhap VARCHAR(100) NOT NULL,
    MatKhau VARCHAR(255) NOT NULL,
    SoDienThoai VARCHAR(20),
    Email VARCHAR(100),
    VaiTro ENUM('BENH_NHAN', 'BAC_SI', 'ADMIN') NOT NULL,
    TrangThai TINYINT DEFAULT 1,
    UNIQUE KEY uq_TenDangNhap (TenDangNhap)
);

CREATE TABLE IF NOT EXISTS BENH_NHAN (
    PatientID INT AUTO_INCREMENT PRIMARY KEY,
    AccountID INT NOT NULL,
    HoTen VARCHAR(100) NOT NULL,
    NgaySinh DATE,
    GioiTinh ENUM('NAM', 'NU', 'KHAC'),
    DiaChi VARCHAR(255),
    FOREIGN KEY (AccountID) REFERENCES TAI_KHOAN(AccountID)
);

CREATE TABLE IF NOT EXISTS CHUYEN_KHOA (
    ChuyenKhoaID INT AUTO_INCREMENT PRIMARY KEY,
    TenChuyenKhoa VARCHAR(100) NOT NULL,
    MoTa TEXT
);

CREATE TABLE IF NOT EXISTS BAC_SI (
    BacSiID INT AUTO_INCREMENT PRIMARY KEY,
    AccountID INT NULL,
    ChuyenKhoaID INT NOT NULL,
    HoTen VARCHAR(100) NOT NULL,
    HocVan VARCHAR(255),
    KinhNghiemNam INT,
    SoDienThoai VARCHAR(20),
    TrangThai TINYINT DEFAULT 1,
    FOREIGN KEY (ChuyenKhoaID) REFERENCES CHUYEN_KHOA(ChuyenKhoaID),
    FOREIGN KEY (AccountID) REFERENCES TAI_KHOAN(AccountID)
);

CREATE TABLE IF NOT EXISTS LICH_HEN (
    LichHenID INT AUTO_INCREMENT PRIMARY KEY,
    PatientID INT NOT NULL,
    BacSiID INT NOT NULL,
    NgayKham DATE NOT NULL,
    GioKham TIME NOT NULL,
    LyDoKham VARCHAR(255),
    TrangThai ENUM('CHO_XAC_NHAN','DA_XAC_NHAN','HUY') DEFAULT 'CHO_XAC_NHAN',
    FOREIGN KEY (PatientID) REFERENCES BENH_NHAN(PatientID),
    FOREIGN KEY (BacSiID) REFERENCES BAC_SI(BacSiID)
);

CREATE INDEX idx_lichhen_bacsi_ngay_gio ON LICH_HEN (BacSiID, NgayKham, GioKham);

INSERT INTO CHUYEN_KHOA (TenChuyenKhoa, MoTa) VALUES
('N·ªôi t·ªïng qu√°t', 'Kh√°m v√† ƒëi·ªÅu tr·ªã c√°c b·ªánh n·ªôi khoa th∆∞·ªùng g·∫∑p'),
('Nhi', 'Kh√°m v√† ƒëi·ªÅu tr·ªã cho tr·∫ª em'),
('Da li·ªÖu', 'Kh√°m v√† ƒëi·ªÅu tr·ªã c√°c b·ªánh v·ªÅ da'),
('RƒÉng H√†m M·∫∑t', 'Kh√°m v√† ƒëi·ªÅu tr·ªã b·ªánh v·ªÅ rƒÉng h√†m m·∫∑t'),
('Tim m·∫°ch', 'Kh√°m v√† ƒëi·ªÅu tr·ªã b·ªánh nh√¢n b·ªánh tim');

INSERT INTO BAC_SI (ChuyenKhoaID, HoTen, HocVan, KinhNghiemNam, SoDienThoai) VALUES
(1, 'BS. L√™ VƒÉn Quang', 'BS N·ªôi t·ªïng qu√°t', 5, '0903297940'),
(2, 'BS. L√™ Th·ªã H·ªìng Nhung', 'BS Nhi', 7, '0375112139'),
(3, 'BS. Tr·∫ßn VƒÉn Ph·ª•c', 'BS Da li·ªÖu', 4, '0912345678'),
(5, 'BS. V≈© Quang Du', 'BS Tim m·∫°ch', 8, '0342961367'),
(4, 'BS. Nguy·ªÖn Kh·∫Øc Ph√°t', 'BS RƒÉng H√†m M·∫∑t', 4, '0987654321');

INSERT INTO TAI_KHOAN (TenDangNhap, MatKhau, VaiTro, TrangThai) VALUES 
('admin', '11072006', 'ADMIN', 1),
('bs_quang', '123456', 'BAC_SI', 1),
('bs_nhung', '123456', 'BAC_SI', 1),
('bs_phuc',  '123456', 'BAC_SI', 1),
('bs_du',    '123456', 'BAC_SI', 1),
('bs_phat',  '123456', 'BAC_SI', 1);

UPDATE BAC_SI SET AccountID = (SELECT AccountID FROM TAI_KHOAN WHERE TenDangNhap = 'bs_quang') WHERE HoTen = 'BS. L√™ VƒÉn Quang';
UPDATE BAC_SI SET AccountID = (SELECT AccountID FROM TAI_KHOAN WHERE TenDangNhap = 'bs_nhung') WHERE HoTen = 'BS. L√™ Th·ªã H·ªìng Nhung';
UPDATE BAC_SI SET AccountID = (SELECT AccountID FROM TAI_KHOAN WHERE TenDangNhap = 'bs_phuc') WHERE HoTen = 'BS. Tr·∫ßn VƒÉn Ph·ª•c';
UPDATE BAC_SI SET AccountID = (SELECT AccountID FROM TAI_KHOAN WHERE TenDangNhap = 'bs_du') WHERE HoTen = 'BS. V≈© Quang Du';
UPDATE BAC_SI SET AccountID = (SELECT AccountID FROM TAI_KHOAN WHERE TenDangNhap = 'bs_phat') WHERE HoTen = 'BS. Nguy·ªÖn Kh·∫Øc Ph√°t';

--Sprint2
ALTER TABLE LICH_HEN 
MODIFY COLUMN TrangThai ENUM('CHO_XAC_NHAN','DA_XAC_NHAN','DA_KHAM','HUY','VANG_MAT') DEFAULT 'CHO_XAC_NHAN';

ALTER TABLE LICH_HEN ADD COLUMN ChanDoan TEXT AFTER LyDoKham;
ALTER TABLE LICH_HEN ADD COLUMN ToaThuoc TEXT AFTER ChanDoan;

CREATE TABLE IF NOT EXISTS DANH_GIA (
    DanhGiaID INT AUTO_INCREMENT PRIMARY KEY,
    LichHenID INT NOT NULL,
    SoSao INT NOT NULL CHECK (SoSao >= 1 AND SoSao <= 5),
    BinhLuan TEXT,
    NgayDanhGia DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (LichHenID) REFERENCES LICH_HEN(LichHenID),
    UNIQUE KEY uq_LichHen_DanhGia (LichHenID)
);

ALTER TABLE BENH_NHAN ADD COLUMN NhanThongBao TINYINT DEFAULT 1;

ALTER TABLE BENH_NHAN ADD COLUMN ShareToken VARCHAR(100) UNIQUE DEFAULT NULL;

====================
FILE: .\routes\auth.py
====================
from flask import Blueprint, render_template, request, redirect, url_for, session
from db import get_connection

auth_bp = Blueprint('auth', __name__)

@auth_bp.route("/")
def trang_chu():
    return redirect(url_for("auth.dang_nhap"))

@auth_bp.route("/dang-ky", methods=["GET", "POST"])
def dang_ky():
    if request.method == "GET":
        return render_template("dang_ky.html")

    ten_dang_nhap = request.form.get("ten_dang_nhap", "").strip()
    mat_khau = request.form.get("mat_khau", "")
    xac_nhan = request.form.get("xac_nhan_mat_khau", "")
    ho_ten = request.form.get("ho_ten", "").strip()
    so_dien_thoai = request.form.get("so_dien_thoai", "").strip()
    email = request.form.get("email", "").strip()
    ngay_sinh = request.form.get("ngay_sinh", None)
    gioi_tinh = request.form.get("gioi_tinh", None)
    dia_chi = request.form.get("dia_chi", "").strip()

    loi = []
    if not ten_dang_nhap: 
        loi.append("T√™n ƒëƒÉng nh·∫≠p kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.")
    if not ho_ten: 
        loi.append("H·ªç t√™n kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.")
    if not mat_khau or not xac_nhan: 
        loi.append("M·∫≠t kh·∫©u kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.")
    if mat_khau and len(mat_khau) < 6:
        loi.append("M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±.")
    if mat_khau != xac_nhan: 
        loi.append("M·∫≠t kh·∫©u kh√¥ng kh·ªõp.")
    if not so_dien_thoai: 
        loi.append("S·ªë ƒëi·ªán tho·∫°i kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.")
    if not email: 
        loi.append("Email kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.")
    
    if loi: 
        return render_template("dang_ky.html", loi=loi)

    conn = get_connection()
    try:
        with conn.cursor() as cur:
            cur.execute("SELECT AccountID FROM TAI_KHOAN WHERE TenDangNhap=%s", (ten_dang_nhap,))
            if cur.fetchone():
                return render_template("dang_ky.html", loi=["T√™n ƒëƒÉng nh·∫≠p ƒë√£ t·ªìn t·∫°i."])
            
            sql_tk = "INSERT INTO TAI_KHOAN (TenDangNhap, MatKhau, SoDienThoai, Email, VaiTro, TrangThai) VALUES (%s, %s, %s, %s, 'BENH_NHAN', 1)"
            cur.execute(sql_tk, (ten_dang_nhap, mat_khau, so_dien_thoai, email))
            account_id = cur.lastrowid
            
            sql_bn = "INSERT INTO BENH_NHAN (AccountID, HoTen, NgaySinh, GioiTinh, DiaChi) VALUES (%s, %s, %s, %s, %s)"
            cur.execute(sql_bn, (account_id, ho_ten, ngay_sinh, gioi_tinh, dia_chi))
        conn.commit()
    finally:
        conn.close()

    return redirect(url_for("auth.dang_nhap"))

@auth_bp.route("/dang-nhap", methods=["GET", "POST"])
def dang_nhap():
    if request.method == "GET":
        return render_template("dang_nhap.html")

    ten_dang_nhap = request.form.get("ten_dang_nhap", "").strip()
    mat_khau = request.form.get("mat_khau", "")
    conn = get_connection()
    user = None
    try:
        with conn.cursor() as cur:
            sql = "SELECT AccountID, TenDangNhap, MatKhau, VaiTro, TrangThai FROM TAI_KHOAN WHERE TenDangNhap=%s"
            cur.execute(sql, (ten_dang_nhap,))
            user = cur.fetchone()
            if user:
                user["HoTen"] = user["TenDangNhap"]
                if user["VaiTro"] == "BAC_SI":
                    cur.execute("SELECT HoTen FROM BAC_SI WHERE AccountID = %s", (user["AccountID"],))
                    bs = cur.fetchone()
                    if bs: 
                        user["HoTen"] = bs["HoTen"]
                elif user["VaiTro"] == "BENH_NHAN":
                    cur.execute("SELECT HoTen FROM BENH_NHAN WHERE AccountID = %s", (user["AccountID"],))
                    bn = cur.fetchone()
                    if bn: 
                        user["HoTen"] = bn["HoTen"]
    finally:
        conn.close()

    if not user or user["MatKhau"] != mat_khau:
        return render_template("dang_nhap.html", loi=["Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u."])
    
    if user["TrangThai"] != 1:
        return render_template("dang_nhap.html", loi=["T√†i kho·∫£n ƒë√£ b·ªã kh√≥a."])

    session["account_id"] = user["AccountID"]
    session["ten_dang_nhap"] = user["TenDangNhap"]
    session["vai_tro"] = user["VaiTro"]
    session["ho_ten"] = user["HoTen"]

    if user["VaiTro"] == "BENH_NHAN":
        return redirect(url_for("benh_nhan.trang_benh_nhan"))
    else:
        return redirect(url_for("bac_si.quan_ly_lich_hen"))

@auth_bp.route("/dang-xuat")
def dang_xuat():
    session.clear()
    return redirect(url_for("auth.dang_nhap"))

====================
FILE: .\routes\bac_si.py
====================
# routes/bac_si.py
from flask import Blueprint, render_template, request, redirect, url_for, session
from db import get_connection

bac_si_bp = Blueprint('bac_si', __name__)

@bac_si_bp.route("/quan-ly-lich-hen")
def quan_ly_lich_hen():
    if "account_id" not in session or session["vai_tro"] not in ['ADMIN', 'BAC_SI']:
        return "B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p."

    conn = get_connection()
    ds_lich_hen = []
    try:
        with conn.cursor() as cur:
            sql = """
                SELECT lh.LichHenID, lh.NgayKham, lh.GioKham, lh.LyDoKham, lh.TrangThai,
                       bn.HoTen AS TenBenhNhan, bn.GioiTinh, bn.NgaySinh, bs.HoTen AS TenBacSi
                FROM LICH_HEN lh
                JOIN BENH_NHAN bn ON lh.PatientID = bn.PatientID
                JOIN BAC_SI bs ON lh.BacSiID = bs.BacSiID
            """
            if session["vai_tro"] == 'BAC_SI':
                cur.execute("SELECT BacSiID FROM BAC_SI WHERE AccountID = %s", (session["account_id"],))
                bs_info = cur.fetchone()
                if bs_info: 
                    sql += f" WHERE lh.BacSiID = {bs_info['BacSiID']}"
            
            sql += " ORDER BY lh.NgayKham DESC, lh.GioKham ASC"
            cur.execute(sql)
            ds_lich_hen = cur.fetchall()
    finally:
        conn.close()
    return render_template("quan_ly_lich_hen.html", ds_lich_hen=ds_lich_hen)

@bac_si_bp.route("/cap-nhat-trang-thai/<int:lich_hen_id>/<trang_thai>", methods=["POST"])
def cap_nhat_trang_thai(lich_hen_id, trang_thai):
    if "account_id" not in session or session["vai_tro"] not in ['ADMIN', 'BAC_SI']:
        return redirect(url_for("auth.dang_nhap"))
    conn = get_connection()
    try:
        with conn.cursor() as cur:
            cur.execute("UPDATE LICH_HEN SET TrangThai = %s WHERE LichHenID = %s", (trang_thai, lich_hen_id))
        conn.commit()
    finally:
        conn.close()
    return redirect(url_for("bac_si.quan_ly_lich_hen"))

@bac_si_bp.route("/luu-ket-qua-kham", methods=["POST"])
def luu_ket_qua_kham():
    if "account_id" not in session or session["vai_tro"] not in ['ADMIN', 'BAC_SI']:
        return redirect(url_for("auth.dang_nhap"))
    lich_hen_id = request.form.get("lich_hen_id")
    chan_doan = request.form.get("chan_doan")
    toa_thuoc = request.form.get("toa_thuoc")
    conn = get_connection()
    try:
        with conn.cursor() as cur:
            cur.execute("UPDATE LICH_HEN SET ChanDoan=%s, ToaThuoc=%s, TrangThai='DA_KHAM' WHERE LichHenID=%s", 
                        (chan_doan, toa_thuoc, lich_hen_id))
        conn.commit()
    finally:
        conn.close()
    return redirect(url_for("bac_si.quan_ly_lich_hen"))

====================
FILE: .\routes\benh_nhan.py
====================
from flask import Blueprint, render_template, request, redirect, url_for, session
from db import get_connection
from datetime import datetime
import uuid

benh_nhan_bp = Blueprint('benh_nhan', __name__)

@benh_nhan_bp.route("/trang-benh-nhan")
def trang_benh_nhan():
    if "account_id" not in session: 
        return redirect(url_for("auth.dang_nhap"))
    
    account_id = session["account_id"]
    conn = get_connection()
    lich_hen = []
    thong_bao_nhac_lich = []
    cai_dat_thong_bao = 1

    try:
        with conn.cursor() as cur:
            cur.execute("SELECT NhanThongBao FROM BENH_NHAN WHERE AccountID = %s", (account_id,))
            bn_info = cur.fetchone()
            if bn_info:
                cai_dat_thong_bao = bn_info["NhanThongBao"]

            sql = """
                SELECT lh.LichHenID, lh.NgayKham, lh.GioKham, lh.TrangThai,
                       bs.HoTen AS TenBacSi, dg.SoSao
                FROM LICH_HEN lh
                JOIN BENH_NHAN bn ON lh.PatientID = bn.PatientID
                JOIN BAC_SI bs ON lh.BacSiID = bs.BacSiID
                LEFT JOIN DANH_GIA dg ON lh.LichHenID = dg.LichHenID
                WHERE bn.AccountID = %s
                ORDER BY lh.NgayKham DESC, lh.GioKham DESC
            """
            cur.execute(sql, (account_id,))
            lich_hen = cur.fetchall()

            if cai_dat_thong_bao == 1:
                now = datetime.now()
                for lh in lich_hen:
                    if lh["TrangThai"] == 'DA_XAC_NHAN':
                        gio_kham_time = (datetime.min + lh["GioKham"]).time()
                        thoi_gian_kham = datetime.combine(lh["NgayKham"], gio_kham_time)
                        diff = thoi_gian_kham - now
                        seconds_diff = diff.total_seconds()
                        if 0 <= seconds_diff <= 86400:
                            msg = f"S·∫Øp ƒë·∫øn l·ªãch kh√°m v·ªõi {lh['TenBacSi']} ng√†y {lh['NgayKham'].strftime('%d/%m')} l√∫c {lh['GioKham']}."
                            thong_bao_nhac_lich.append(msg)

            for lh in lich_hen:
                if lh["NgayKham"]: lh["NgayKham"] = lh["NgayKham"].strftime("%d/%m/%Y")
            
    finally:
        conn.close()

    return render_template("trang_benh_nhan.html",
        lich_hen=lich_hen,
        thong_bao_nhac_lich=thong_bao_nhac_lich,
        cai_dat_thong_bao=cai_dat_thong_bao
    )

@benh_nhan_bp.route("/quan-ly-chia-se")
def quan_ly_chia_se():
    if "account_id" not in session: 
        return redirect(url_for("auth.dang_nhap"))
    
    conn = get_connection()
    share_token = None
    try:
        with conn.cursor() as cur:
            cur.execute("SELECT ShareToken FROM BENH_NHAN WHERE AccountID = %s", (session["account_id"],))
            bn = cur.fetchone()
            if bn:
                share_token = bn["ShareToken"]
    finally:
        conn.close()
        
    return render_template("quan_ly_chia_se.html", share_token=share_token)

@benh_nhan_bp.route("/tao-lien-ket-chia-se", methods=["POST"])
def tao_lien_ket_chia_se():
    if "account_id" not in session: 
        return redirect(url_for("auth.dang_nhap"))
    
    action = request.form.get("hanh_dong")
    conn = get_connection()
    try:
        with conn.cursor() as cur:
            token = str(uuid.uuid4()) if action == "tao" else None
            cur.execute("UPDATE BENH_NHAN SET ShareToken = %s WHERE AccountID = %s", (token, session["account_id"]))
        conn.commit()
    finally:
        conn.close()
    
    return redirect(url_for("benh_nhan.quan_ly_chia_se"))


@benh_nhan_bp.route("/dat-lich", methods=["GET", "POST"])
def dat_lich():
    if "account_id" not in session: 
        return redirect(url_for("auth.dang_nhap"))
    account_id = session["account_id"]
    conn = get_connection()
    try:
        with conn.cursor() as cur:
            cur.execute("SELECT PatientID FROM BENH_NHAN WHERE AccountID = %s", (account_id,))
            bn = cur.fetchone()
            if not bn: 
                return "L·ªói: Kh√¥ng t√¨m th·∫•y th√¥ng tin b·ªánh nh√¢n."
            patient_id = bn["PatientID"]

            cur.execute("SELECT BacSiID, HoTen FROM BAC_SI WHERE TrangThai = 1")
            ds_bac_si = cur.fetchall()

            if request.method == "GET":
                return render_template("dat_lich.html", ds_bac_si=ds_bac_si)

            bac_si_id = request.form.get("bac_si")
            ngay_kham = request.form.get("ngay_kham")
            gio_kham = request.form.get("gio_kham")
            ly_do = request.form.get("ly_do")

            sql_insert = "INSERT INTO LICH_HEN (PatientID, BacSiID, NgayKham, GioKham, LyDoKham, TrangThai) VALUES (%s, %s, %s, %s, %s, 'CHO_XAC_NHAN')"
            cur.execute(sql_insert, (patient_id, bac_si_id, ngay_kham, gio_kham, ly_do))
            conn.commit()
            return redirect(url_for("benh_nhan.trang_benh_nhan"))
    finally:
        conn.close()

@benh_nhan_bp.route("/huy-lich/<int:lich_hen_id>", methods=["POST"])
def huy_lich(lich_hen_id):
    if "account_id" not in session: 
        return redirect(url_for("auth.dang_nhap"))
    conn = get_connection()
    try:
        with conn.cursor() as cur:
            cur.execute("""
                UPDATE LICH_HEN lh JOIN BENH_NHAN bn ON lh.PatientID = bn.PatientID
                SET lh.TrangThai = 'HUY'
                WHERE lh.LichHenID = %s AND bn.AccountID = %s AND lh.TrangThai IN ('CHO_XAC_NHAN', 'DA_XAC_NHAN')
            """, (lich_hen_id, session["account_id"]))
        conn.commit()
    finally:
        conn.close()
    return redirect(url_for("benh_nhan.trang_benh_nhan"))

@benh_nhan_bp.route("/danh-gia/<int:lich_hen_id>", methods=["GET", "POST"])
def danh_gia(lich_hen_id):
    if "account_id" not in session: 
        return redirect(url_for("auth.dang_nhap"))
    conn = get_connection()
    try:
        with conn.cursor() as cur:
            cur.execute("""
                SELECT lh.LichHenID, bs.HoTen as TenBacSi, lh.NgayKham
                FROM LICH_HEN lh JOIN BENH_NHAN bn ON lh.PatientID = bn.PatientID JOIN BAC_SI bs ON lh.BacSiID = bs.BacSiID
                WHERE lh.LichHenID = %s AND bn.AccountID = %s AND lh.TrangThai = 'DA_KHAM'
            """, (lich_hen_id, session["account_id"]))
            lich = cur.fetchone()
            if not lich: 
                return "L·ªói: L·ªãch h·∫πn kh√¥ng h·ª£p l·ªá."

            if request.method == "GET":
                return render_template("danh_gia.html", lich=lich)

            so_sao = request.form.get("so_sao")
            binh_luan = request.form.get("binh_luan", "")
            cur.execute("INSERT INTO DANH_GIA (LichHenID, SoSao, BinhLuan) VALUES (%s, %s, %s)", (lich_hen_id, so_sao, binh_luan))
            conn.commit()
            return redirect(url_for("benh_nhan.trang_benh_nhan"))
    finally:
        conn.close()

@benh_nhan_bp.route("/cai-dat-thong-bao", methods=["POST"])
def xu_ly_cai_dat_thong_bao():
    if "account_id" not in session: 
        return redirect(url_for("auth.dang_nhap"))
    trang_thai = 1 if request.form.get("nhan_thong_bao") == "on" else 0
    conn = get_connection()
    try:
        with conn.cursor() as cur:
            cur.execute("UPDATE BENH_NHAN SET NhanThongBao = %s WHERE AccountID = %s", (trang_thai, session["account_id"]))
        conn.commit()
    finally:
        conn.close()
    return redirect(url_for("benh_nhan.trang_benh_nhan"))

====================
FILE: .\routes\public.py
====================
from flask import Blueprint, render_template
from db import get_connection

public_bp = Blueprint('public', __name__)

@public_bp.route("/thong-tin-phong-kham")
def thong_tin_phong_kham():
    conn = get_connection()
    ds_bac_si = []
    try:
        with conn.cursor() as cur:
            sql = """
                SELECT bs.BacSiID, bs.HoTen, bs.KinhNghiemNam, bs.SoDienThoai, ck.TenChuyenKhoa,
                    COUNT(dg.DanhGiaID) as LuotDanhGia, IFNULL(AVG(dg.SoSao), 0) as DiemTrungBinh
                FROM BAC_SI bs
                JOIN CHUYEN_KHOA ck ON bs.ChuyenKhoaID = ck.ChuyenKhoaID
                LEFT JOIN LICH_HEN lh ON bs.BacSiID = lh.BacSiID
                LEFT JOIN DANH_GIA dg ON lh.LichHenID = dg.LichHenID
                WHERE bs.TrangThai = 1
                GROUP BY bs.BacSiID
                ORDER BY DiemTrungBinh DESC
            """
            cur.execute(sql)
            ds_bac_si = cur.fetchall()
            for bs in ds_bac_si: 
                bs['DiemTrungBinh'] = round(bs['DiemTrungBinh'], 1)
    finally:
        conn.close()

    thong_tin = {
        "ten": "Ph√≤ng kh√°m ƒêa khoa Thu·ª∑ L·ª£i",
        "dia_chi": "175 T√¢y S∆°n, ƒê·ªëng ƒêa, H√† N·ªôi",
        "so_dien_thoai": "0903297940",
        "gio_lam_viec": "Th·ª© 2 - Th·ª© 7: 7h30 - 17h00"
    }
    return render_template("thong_tin_phong_kham.html", thong_tin=thong_tin, ds_bac_si=ds_bac_si)

@public_bp.route("/ho-so-y-te/<token>")
def xem_ho_so_cong_khai(token):
    conn = get_connection()
    benh_nhan = None
    lich_su_kham = []
    try:
        with conn.cursor() as cur:
            cur.execute("SELECT HoTen, GioiTinh, NgaySinh, DiaChi FROM BENH_NHAN WHERE ShareToken = %s", (token,))
            benh_nhan = cur.fetchone()
            if not benh_nhan: 
                return "Li√™n k·∫øt kh√¥ng t·ªìn t·∫°i."
            
            if benh_nhan['NgaySinh']: 
                benh_nhan['NgaySinh'] = benh_nhan['NgaySinh'].strftime("%d/%m/%Y")

            sql_ls = """
                SELECT lh.NgayKham, lh.LyDoKham, lh.ChanDoan, lh.ToaThuoc, bs.HoTen as TenBacSi, ck.TenChuyenKhoa
                FROM LICH_HEN lh
                JOIN BENH_NHAN bn ON lh.PatientID = bn.PatientID
                JOIN BAC_SI bs ON lh.BacSiID = bs.BacSiID
                JOIN CHUYEN_KHOA ck ON bs.ChuyenKhoaID = ck.ChuyenKhoaID
                WHERE bn.ShareToken = %s AND lh.TrangThai = 'DA_KHAM'
                ORDER BY lh.NgayKham DESC
            """
            cur.execute(sql_ls, (token,))
            lich_su_kham = cur.fetchall()
            for ls in lich_su_kham:
                if ls['NgayKham']: ls['NgayKham'] = ls['NgayKham'].strftime("%d/%m/%Y")
    finally:
        conn.close()
    return render_template("ho_so_public.html", bn=benh_nhan, ls=lich_su_kham)

====================
FILE: .\routes\__init__.py
====================


====================
FILE: .\static\style.css
====================
:root{
  --bg-main: #f4f8fd;
  --bg-card: #ffffff;

  --blue: #2563eb;
  --blue-soft: #eaf1ff;
  --blue-hover: #1d4ed8;

  --green: #22c55e;
  --green-soft: #ecfdf5;

  --red: #ef4444;
  --red-soft: #fef2f2;

  --text-main: #0f172a;
  --text-muted: #64748b;

  --border: #e5e7eb;

  --shadow-main: 0 12px 30px rgba(15, 23, 42, 0.08);
  --shadow-soft: 0 6px 16px rgba(15, 23, 42, 0.06);

  --radius: 16px;
}

*{ box-sizing: border-box; }

html, body{ height: 100%; }

body{
  margin: 0;
  font-family: Arial, sans-serif;
  color: var(--text-main);

  background:
    radial-gradient(800px 500px at 10% 10%, #c7d2fe 0%, transparent 60%),
    radial-gradient(700px 450px at 90% 15%, #bbf7d0 0%, transparent 55%),
    radial-gradient(600px 400px at 50% 100%, #bae6fd 0%, transparent 60%),
    linear-gradient(180deg, #f0f9ff, #f8fafc);

  min-height: 100vh;
}


a{
  color: var(--blue);
  text-decoration: none;
}
a:hover{ text-decoration: underline; }

.app-shell{
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.container{
  width: min(1100px, 92vw);
  margin: 18px auto 30px auto;
}

.topbar{
  width: min(1100px, 92vw);
  margin: 18px auto 0 auto;
  padding: 14px 16px;

  background: rgba(255,255,255,0.75);
  backdrop-filter: blur(10px);

  border-radius: var(--radius);
  border: 1px solid var(--border);
  box-shadow: var(--shadow-soft);

  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12x;
}

.brand{
  display: flex;
  align-items: center;
  gap: 12px;
}

.brand__logo{
  width: 46px;
  height: 46px;
  border-radius: 14px;
  background: #ffffff;
  box-shadow: var(--shadow-soft);
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.brand__logo img{
  width: 80%;
  height: 80%;
  object-fit: contain;
}


.brand__name{
  font-weight: 800;
  font-size: 16px;
}
.brand__sub{
  font-size: 12px;
  color: var(--text-muted);
}

.topbar__actions{
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.footer{
  margin-top: auto;
  width: min(1100px, 92vw);
  margin-left: auto;
  margin-right: auto;
  padding: 18px 0 22px 0;
  color: var(--text-muted);
  font-size: 12px;
  text-align: center;
}

.card{
  background: var(--bg-card);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  box-shadow: var(--shadow-main);
  padding: 18px;
}

.card__header{
  margin-bottom: 12px;
}
.card__header--row{
  display: flex;
  justify-content: space-between;
  gap: 12px;
  flex-wrap: wrap;
}

.h1{
  margin: 0;
  font-size: 22px;
}
.muted{
  margin-top: 6px;
  font-size: 14px;
  color: var(--text-muted);
}

.auth{
  width: min(520px, 92vw);
  margin: 20px auto;
}
.auth--wide{
  width: min(860px, 92vw);
}

.auth__footer{
  margin-top: 14px;
  padding-top: 10px;
  border-top: 1px dashed var(--border);
  display: flex;
  justify-content: center;
  gap: 8px;
}

.form{ margin-top: 12px; }
.label{
  display: block;
  font-size: 13px;
  color: var(--text-muted);
  margin: 10px 0 6px 0;
}

.input{
  width: 100%;
  padding: 11px 12px;
  border-radius: 14px;
  border: 1px solid var(--border);
  font-size: 14px;
}

.input:focus{
  outline: none;
  border-color: var(--blue);
  box-shadow: 0 0 0 4px rgba(37,99,235,0.15);
}

.form--grid{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px 14px;
}
.field--full{ grid-column: 1 / -1; }

.row{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
}

.alert{
  background: var(--red-soft);
  border: 1px solid #fecaca;
  color: #b91c1c;
  padding: 10px 12px;
  border-radius: 14px;
  margin-top: 12px;
}

.alert li{ margin-left: 18px; }

.btn{
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 10px 16px;
  border-radius: 14px;
  border: none;
  font-size: 14px;
  cursor: pointer;
  margin-top: 17px;
  margin-bottom: 10px;
}

.btn-primary{
  background: linear-gradient(180deg, var(--blue), var(--blue-hover));
  color: #fff;
  box-shadow: 0 10px 18px rgba(37,99,235,0.25);
}

.btn-outline{
  background: #fff;
  border: 1px solid var(--border);
  color: var(--text-main);
}

.btn-ghost{
  background: transparent;
  color: var(--text-muted);
  color: #1316da;
}

.btn-danger{
  background: linear-gradient(180deg, var(--red), #dc2626);
  color: #fff;
  box-shadow: 0 10px 18px rgba(239,68,68,0.25);
}

.table-wrap{
  border-radius: var(--radius);
  border: 1px solid var(--border);
  overflow: hidden;
  background: #fff;
}

.table{
  width: 100%;
  border-collapse: collapse;
}

.table thead{
  background: var(--blue-soft);
}

.table th,
.table td{
  padding: 12px 14px;
  border-bottom: 1px solid var(--border);
}

.table tr:hover{
  background: #f8fbff;
}

.t-center{ text-align: center; }

.badge{
  padding: 6px 12px;
  border-radius: 999px;
  font-size: 13px;
  font-weight: 700;
}

.badge--CHO_XAC_NHAN{
  background: #fff7ed;
  color: #9a3412;
}
.badge--DA_XAC_NHAN{
  background: var(--blue-soft);
  color: var(--blue);
}
.badge--HUY{
  background: var(--red-soft);
  color: var(--red);
}
.badge--DA_KHAM{
  background: var(--green-soft);
  color: var(--green);
}
.badge--VANG_MAT {
  background: #f1f5f9;
  color: #475569;
  border: 1px solid #cbd5e1;
}

.info{
  display: grid;
  gap: 10px;
}
.info__row{
  background: #fbfdff;
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 10px 12px;
}
.info__label{
  font-weight: 700;
  color: var(--text-muted);
}

.grid-2{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
}

@media (max-width: 860px){
  .grid-2{ grid-template-columns: 1fr; }
  .form--grid{ grid-template-columns: 1fr; }
  .row{ grid-template-columns: 1fr; }
  .card__header--row{ flex-direction: column; }
}

.auth__footer{
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 6px;

  margin: 12px 0 0 0;
  padding: 10px 0 0 0;
  line-height: 1;

  font-size: 14px;
}

.auth__footer .muted{
  margin: 0 !important;
  line-height: 1;
  display: inline-flex;
  align-items: center;
}

.auth__footer .link{
  line-height: 1;
  display: inline-flex;
  align-items: center;
}





/*SPRINT2*/







.user-info {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  
  background-color: #fff;
  border: 1px solid var(--border);
  color: var(--text-muted);
  
  padding: 14px 30px; 
  
  border-radius: 99px;
  
  margin-right: 8px;
  margin-top: 17px;
  margin-bottom: 10px;
  
  font-size: 14px;
  box-shadow: var(--shadow-soft);
}

.user-info strong {
  color: var(--blue);
  font-weight: 700;
}

.user-info:hover {
  background-color: #fff;
  border-color: var(--blue);
  box-shadow: var(--shadow-soft);
  cursor: default;
}

@media (max-width: 600px) {
  .user-info {
    padding: 6px 10px;
    font-size: 12px;
  }
}


.page-public {
  background-color: #f1f5f9;
  padding: 20px;
}

.container--narrow {
  max-width: 800px;
  margin-left: auto;
  margin-right: auto;
}


.public-header {
  display: flex;
  align-items: center;
  justify-content: flex-start; 
  gap: 15px;
  
  padding: 15px 20px;
  text-align: left;
  margin-bottom: 20px;
}

.logo-circle {
  width: 42px;
  height: 42px;
  margin: 0;
  flex-shrink: 0;
  background: var(--blue-soft);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.logo-circle img {
  width: 24px;
  opacity: 1;
}

.text-blue { color: var(--blue); }
.text-blue-dark { color: #1e3a8a; }
.text-dark { color: #334155; }
.text-bold { font-weight: bold; }
.text-lg { font-size: 16px; }
.font-medium { font-weight: 500; }

.mb-20 { margin-bottom: 20px; }
.mb-8 { margin-bottom: 8px; }
.font-18 { font-size: 18px; }
.font-14 { font-size: 14px; }
.font-12 { font-size: 12px; }

.col-top { vertical-align: top; }
.col-date { width: 120px; }
.col-doc { width: 180px; }

.rating-badge {
  margin-top: 5px;
  font-size: 11px;
  color: #f59e0b;
  font-style: italic;
}

.tag {
  display: inline-block;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: bold;
  margin-right: 4px;
}

.tag--gray {
  background: #f1f5f9;
  color: #64748b;
}

.tag--blue {
  background: #dbeafe;
  color: #1e40af;
}

.tag--green {
  background: #dcfce7;
  color: #166534;
}

.text-pre-line {
  margin-top: 4px;
  white-space: pre-line;
}

.empty-state {
  text-align: center;
  padding: 40px;
  color: var(--text-muted);
}


.timeline-container {
  position: relative;
  padding-left: 0;
}

.timeline-container::before {
  content: '';
  position: absolute;
  left: 100px;
  top: 15px;
  bottom: 0;
  width: 2px;
  background: #e2e8f0;
}

.timeline-item {
  display: flex;
  gap: 25px;
  margin-bottom: 30px;
  position: relative;
}

.timeline-date {
  width: 100px;
  flex-shrink: 0;
  text-align: right;
  padding-right: 20px;
  padding-top: 10px;
  box-sizing: border-box;
}

.date-box .day { 
  display: block; 
  font-size: 24px; 
  font-weight: bold; 
  color: var(--blue); 
  line-height: 1; 
}
.date-box .month, .date-box .year { 
    display: block; 
    font-size: 12px; 
    color: #64748b; 
    margin-top: 2px; 
}

.timeline-content {
    flex: 1;
    position: relative;
    background: #ffffff;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.02);
    padding: 15px;
}

.timeline-content::before {
    content: '';
    position: absolute;
    left: -29px; 
    top: 20px;
    width: 12px;
    height: 12px;
    background: var(--blue);
    border: 3px solid #fff;
    border-radius: 50%;
    box-shadow: 0 0 0 2px var(--blue-soft);
    z-index: 1;
}

.header-content { border-bottom: 1px solid #f1f5f9; padding-bottom: 8px; margin-bottom: 8px; }
.doc-name { margin: 0; font-size: 16px; font-weight: 700; color: #1e293b; }
.dept-name { font-size: 13px; color: #64748b; }
.row-item { margin-bottom: 4px; font-size: 14px; color: #334155; }
.prescription-box { 
    background: #f0fdf4; 
    padding: 10px; 
    border-radius: 8px; 
    font-size: 13px; 
    margin-top: 10px; 
    white-space: pre-line; 
    border: 1px dashed #86efac; 
    color: #166534;
}

.d-flex { display: flex; align-items: center; }
.d-flex-between { display: flex; align-items: center; justify-content: space-between; }
.gap-5 { gap: 5px; }
.gap-10 { gap: 10px; }
.gap-15 { gap: 15px; }
.mb-15 { margin-bottom: 15px; }
.mb-20 { margin-bottom: 20px; }
.mt-15 { margin-top: 15px; }
.w-100 { width: 100%; }
.text-bold { font-weight: 700; }
.text-sm { font-size: 12px; }
.text-center { text-align: center; }
.text-warning { color: #f59e0b; }

.rating-group {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
    align-items: center;
}
.rating-group label {
    cursor: pointer;
}

.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.5);
    backdrop-filter: blur(2px);
}
.modal-content {
    margin: 10% auto;
    width: 500px;
    max-width: 90%;
    position: relative;
}
.modal-close {
    position: absolute;
    right: 20px;
    top: 15px;
    font-size: 24px;
    cursor: pointer;
    color: #aaa;
    transition: color 0.2s;
}
.modal-close:hover { color: var(--red); }

.btn-sm {
    padding: 6px 10px;
    font-size: 12px;
    margin: 0;
}

.alert-warning {
    background-color: #fffbeb;
    border: 1px solid #fcd34d;
    color: #92400e;
    padding: 15px;
    border-radius: var(--radius);
}
.alert-warning ul { margin: 0; padding-left: 24px; }

.qr-layout {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    align-items: flex-start;
}
.qr-box {
    background: white;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid var(--border);
    flex-shrink: 0;
}
.qr-content { flex: 1; }
.qr-link-input {
    font-size: 13px;
    background: #e2e8f0;
    color: #475569;
    padding: 10px;
    width: 100%;
    border-radius: 8px;
    border: 1px solid var(--border);
    margin-bottom: 15px;
    cursor: copy;
}
.share-status {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 8px;
    color: var(--green);
    font-weight: bold;
}
.share-status-dot { font-size: 18px; }

.switch {
    position: relative;
    display: inline-block;
    width: 36px;
    height: 20px;
}
.switch input { opacity: 0; width: 0; height: 0; }
.slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 34px;
}
.slider:before {
    position: absolute;
    content: "";
    height: 14px; width: 14px;
    left: 3px; bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}
input:checked + .slider { background-color: var(--blue); }
input:checked + .slider:before { transform: translateX(16px); }


.widget-card {
    display: flex;
    align-items: center; 
    justify-content: space-between;
    padding: 15px 20px; 
    height: 100%; 
}
.widget-text h3 {
    font-size: 16px;
    margin: 0 0 4px 0;
    line-height: 1.2;
}

.widget-text p {
    font-size: 13px;
    margin: 0;
    color: var(--text-muted);
}

.widget-form {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    margin: 0;
}

====================
FILE: .\templates\base.html
====================
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Ph√≤ng kh√°m nh√≥m 3{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
  <div class="app-shell">
    
    <header class="topbar">
      <div class="brand">
        <div class="brand__logo">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo y t·∫ø">
        </div>
        <div class="brand__text">
          <div class="brand__name">Ph√≤ng kh√°m nh√≥m 3</div>
          <div class="brand__sub">H·ªá th·ªëng qu·∫£n l√Ω l·ªãch kh√°m</div>
        </div>
      </div>

      <div class="topbar__actions">
        {% block top_actions %}{% endblock %}
      </div>
    </header>

    <main class="container">
      {% block content %}{% endblock %}
    </main>
  </div>
</body>
</html>

====================
FILE: .\templates\dang_ky.html
====================
{% extends "base.html" %}

{% block title %}
ƒêƒÉng k√Ω
{% endblock %}

{% block content %}
<div class="card auth auth--wide">

  <div class="card__header">
    <h1 class="h1">ƒêƒÉng k√Ω t√†i kho·∫£n</h1>
    <p class="muted">Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin ƒë·ªÉ t·∫°o t√†i kho·∫£n</p>
  </div>

  {% if loi %}
    <ul class="alert">
      {% for msg in loi %}
        <li>{{ msg }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  <form method="post" class="form form--grid">

    <div class="field">
      <label class="label" for="ten_dang_nhap">T√™n ƒëƒÉng nh·∫≠p</label>
      <input class="input" type="text" id="ten_dang_nhap" name="ten_dang_nhap" required>
    </div>

    <div class="field">
      <label class="label" for="email">Email</label>
      <input class="input" type="email" id="email" name="email" required>
    </div>

    <div class="field">
      <label class="label" for="mat_khau">M·∫≠t kh·∫©u</label>
      <input class="input" type="password" id="mat_khau" name="mat_khau" required>
    </div>

    <div class="field">
      <label class="label" for="xac_nhan_mat_khau">Nh·∫≠p l·∫°i m·∫≠t kh·∫©u</label>
      <input class="input" type="password" id="xac_nhan_mat_khau" name="xac_nhan_mat_khau" required>
    </div>

    <div class="field">
      <label class="label" for="ho_ten">H·ªç t√™n</label>
      <input class="input" type="text" id="ho_ten" name="ho_ten" required>
    </div>

    <div class="field">
      <label class="label" for="so_dien_thoai">S·ªë ƒëi·ªán tho·∫°i</label>
      <input class="input" type="text" id="so_dien_thoai" name="so_dien_thoai">
    </div>

    <div class="field">
      <label class="label" for="ngay_sinh">Ng√†y sinh</label>
      <input class="input" type="date" id="ngay_sinh" name="ngay_sinh">
    </div>

    <div class="field">
      <label class="label" for="gioi_tinh">Gi·ªõi t√≠nh</label>
      <select class="input" id="gioi_tinh" name="gioi_tinh">
        <option value="">-- Ch·ªçn --</option>
        <option value="NAM">Nam</option>
        <option value="NU">N·ªØ</option>
        <option value="KHAC">Kh√°c</option>
      </select>
    </div>

    <div class="field field--full">
      <label class="label" for="dia_chi">ƒê·ªãa ch·ªâ</label>
      <textarea class="input" id="dia_chi" name="dia_chi" rows="3"></textarea>
    </div>

    <div class="field field--full">
      <button type="submit" class="btn btn-primary">
        T·∫°o t√†i kho·∫£n
      </button>
    </div>

  </form>

  <div class="auth__footer">
    <span class="muted">ƒê√£ c√≥ t√†i kho·∫£n?</span>
    <a class="link" href="{{ url_for('auth.dang_nhap') }}">ƒêƒÉng nh·∫≠p</a>
  </div>

</div>
{% endblock %}

====================
FILE: .\templates\dang_nhap.html
====================
{% extends "base.html" %}

{% block title %}
ƒêƒÉng nh·∫≠p
{% endblock %}

{% block content %}
<div class="card auth">

  <div class="card__header">
    <h1 class="h1">ƒêƒÉng nh·∫≠p</h1>
    <p class="muted">Vui l√≤ng nh·∫≠p th√¥ng tin ƒë·ªÉ truy c·∫≠p h·ªá th·ªëng</p>
  </div>

  {% if loi %}
    <ul class="alert">
      {% for msg in loi %}
        <li>{{ msg }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  <form method="post" class="form">

    <label class="label" for="ten_dang_nhap">T√™n ƒëƒÉng nh·∫≠p</label>
    <input class="input" type="text" id="ten_dang_nhap" name="ten_dang_nhap" required>

    <label class="label" for="mat_khau">M·∫≠t kh·∫©u</label>
    <input class="input" type="password" id="mat_khau" name="mat_khau" required>

    <button type="submit" class="btn btn-primary">
      ƒêƒÉng nh·∫≠p
    </button>

  </form>

  <div class="auth__footer">
    <span class="muted">Ch∆∞a c√≥ t√†i kho·∫£n?</span>
    <a class="link" href="{{ url_for('auth.dang_ky') }}">ƒêƒÉng k√Ω</a>
  </div>

</div>
{% endblock %}

====================
FILE: .\templates\danh_gia.html
====================
{% extends "base.html" %}

{% block title %}ƒê√°nh gi√° b√°c sƒ©{% endblock %}

{% block content %}
<div class="card auth">
  <div class="card__header">
    <h1 class="h1">ƒê√°nh gi√° d·ªãch v·ª•</h1>
    <p class="muted">B√°c sƒ©: <strong>{{ lich.TenBacSi }}</strong></p>
    <p class="muted text-sm">Ng√†y kh√°m: {{ lich.NgayKham }}</p>
  </div>

  <form method="post" class="form">
    <label class="label">M·ª©c ƒë·ªô h√†i l√≤ng</label>
    
    <div class="rating-group">
        <label><input type="radio" name="so_sao" value="5" checked> ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (Tuy·ªát v·ªùi)</label>
    </div>
    <div class="rating-group">
        <label><input type="radio" name="so_sao" value="4"> ‚≠ê‚≠ê‚≠ê‚≠ê (T·ªët)</label>
    </div>
    <div class="rating-group">
        <label><input type="radio" name="so_sao" value="3"> ‚≠ê‚≠ê‚≠ê (B√¨nh th∆∞·ªùng)</label>
    </div>
    <div class="rating-group">
        <label><input type="radio" name="so_sao" value="2"> ‚≠ê‚≠ê (T·ªá)</label>
    </div>
    <div class="rating-group">
        <label><input type="radio" name="so_sao" value="1"> ‚≠ê (R·∫•t t·ªá)</label>
    </div>

    <label class="label" for="binh_luan">Nh·∫≠n x√©t c·ªßa b·∫°n</label>
    <textarea class="input" id="binh_luan" name="binh_luan" rows="4" placeholder="B√°c sƒ© kh√°m nh∆∞ th·∫ø n√†o?"></textarea>

    <button type="submit" class="btn btn-primary">G·ª≠i ƒë√°nh gi√°</button>
    <a href="{{ url_for('benh_nhan.trang_benh_nhan') }}" class="btn btn-ghost">Quay l·∫°i</a>
  </form>
</div>
{% endblock %}

====================
FILE: .\templates\dat_lich.html
====================
{% extends "base.html" %}

{% block title %}
ƒê·∫∑t l·ªãch kh√°m
{% endblock %}

{% block top_actions %}
<a class="btn btn-ghost" href="{{ url_for('benh_nhan.trang_benh_nhan') }}">‚Üê Trang b·ªánh nh√¢n</a>
{% endblock %}

{% block content %}
<div class="card auth auth-large">

  <div class="card__header">
    <h1 class="h1">ƒê·∫∑t l·ªãch kh√°m</h1>
    <p class="muted">Ch·ªçn b√°c sƒ© v√† th·ªùi gian ph√π h·ª£p ƒë·ªÉ ƒë·∫∑t l·ªãch</p>
  </div>

  {% if loi %}
    <ul class="alert">
      {% for msg in loi %}
        <li>{{ msg }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  <form method="post" class="form">

    <label class="label" for="bac_si">Ch·ªçn b√°c sƒ©</label>
    <select class="input" id="bac_si" name="bac_si" required>
      <option value="">-- Ch·ªçn b√°c sƒ© --</option>
      {% for bs in ds_bac_si %}
        <option value="{{ bs.BacSiID }}">{{ bs.HoTen }}</option>
      {% endfor %}
    </select>

    <div class="row">
      <div class="field">
        <label class="label" for="ngay_kham">Ng√†y kh√°m</label>
        <input class="input" type="date" id="ngay_kham" name="ngay_kham" required>
      </div>

      <div class="field">
        <label class="label" for="gio_kham">Gi·ªù kh√°m</label>
        <input class="input" type="time" id="gio_kham" name="gio_kham" required>
      </div>
    </div>

    <label class="label" for="ly_do">L√Ω do kh√°m (tu·ª≥ ch·ªçn)</label>
    <textarea class="input" id="ly_do" name="ly_do" rows="3"></textarea>

    <button type="submit" class="btn btn-primary">
      X√°c nh·∫≠n ƒë·∫∑t l·ªãch
    </button>

    <div class="hint">
      <a class="link" href="{{ url_for('public.thong_tin_phong_kham') }}">
        Xem th√¥ng tin ph√≤ng kh√°m & b√°c sƒ©
      </a>
    </div>

  </form>

</div>
{% endblock %}

====================
FILE: .\templates\ho_so_public.html
====================
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>H·ªì s∆° s·ª©c kh·ªèe ƒëi·ªán t·ª≠</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="page-public">

  <div class="container container--narrow">
    
    <div class="card public-header">
        <div class="logo-circle">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo">
        </div>
        
        <div class="header-text">
            <h1 class="h1 text-blue" style="margin: 0; font-size: 18px;">H·ªì S∆° Y T·∫ø Tr·ª±c Tuy·∫øn</h1>
            <p class="muted" style="margin: 0; font-size: 13px;">Ph√≤ng kh√°m ƒêa khoa Thu·ª∑ L·ª£i</p>
        </div>
    </div>

    <div class="card mb-20">
        <div class="card__header">
            <h2 class="h1 font-18">Th√¥ng tin h√†nh ch√≠nh</h2>
        </div>
        <div class="info">
            <div class="info__row">
                <span class="info__label">H·ªç t√™n:</span>
                <span class="text-lg text-bold">{{ bn.HoTen }}</span>
            </div>
            <div class="row">
                <div class="info__row">
                    <span class="info__label">Ng√†y sinh:</span>
                    <span>{{ bn.NgaySinh }}</span>
                </div>
                <div class="info__row">
                    <span class="info__label">Gi·ªõi t√≠nh:</span>
                    <span>
                        {% if bn.GioiTinh == 'NAM' %} Nam 
                        {% elif bn.GioiTinh == 'NU' %} N·ªØ 
                        {% else %} Kh√°c {% endif %}
                    </span>
                </div>
            </div>
            <div class="info__row">
                <span class="info__label">ƒê·ªãa ch·ªâ:</span>
                <span>{{ bn.DiaChi }}</span>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card__header">
            <h2 class="h1 font-18">L·ªãch s·ª≠ kh√°m b·ªánh</h2>
            <p class="muted">Danh s√°ch c√°c l·∫ßn kh√°m ƒë√£ ho√†n th√†nh</p>
        </div>

        {% if ls %}
            <div class="table-wrap">
                <div class="timeline-container">
                    {% for item in ls %}
                    <div class="timeline-item">
                        <div class="timeline-date">
                            <div class="date-box">
                                <span class="day">{{ item.NgayKham.split('/')[0] }}</span>
                                <span class="month">Th√°ng {{ item.NgayKham.split('/')[1] }}</span>
                                <span class="year">{{ item.NgayKham.split('/')[2] }}</span>
                            </div>
                        </div>

                        <div class="timeline-content card">
                            <div class="header-content">
                                <h3 class="doc-name">{{ item.TenBacSi }}</h3>
                                <span class="dept-name">{{ item.TenChuyenKhoa }}</span>
                            </div>
                            
                            <div class="body-content">
                                <div class="row-item">
                                    <strong>L√Ω do:</strong> {{ item.LyDoKham }}
                                </div>
                                <div class="row-item highlight">
                                    <strong>Ch·∫©n ƒëo√°n:</strong> {{ item.ChanDoan }}
                                </div>
                                {% if item.ToaThuoc %}
                                <div class="prescription-box">
                                    <strong>üíä Toa thu·ªëc:</strong><br>
                                    {{ item.ToaThuoc }}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        {% else %}
            <div class="empty-state">
                <p>Ch∆∞a c√≥ l·ªãch s·ª≠ kh√°m b·ªánh n√†o ƒë∆∞·ª£c ghi nh·∫≠n.</p>
            </div>
        {% endif %}
    </div>
  </div>
</body>
</html>

====================
FILE: .\templates\quan_ly_chia_se.html
====================
{% extends "base.html" %}

{% block title %}Qu·∫£n l√Ω chia s·∫ª h·ªì s∆°{% endblock %}

{% block top_actions %}
  <a class="btn btn-ghost" href="{{ url_for('benh_nhan.trang_benh_nhan') }}">‚Üê Quay l·∫°i</a>
{% endblock %}

{% block content %}
<div class="card auth auth-large">
    <div class="card__header">
        <h1 class="h1">Chia s·∫ª h·ªì s∆° y t·∫ø</h1>
        <p class="muted">T·∫°o m√£ QR ƒë·ªÉ b√°c sƒ© kh√°c c√≥ th·ªÉ xem l·ªãch s·ª≠ kh√°m c·ªßa b·∫°n.</p>
    </div>

    <div class="mt-15">
        {% if share_token %}
            <div class="qr-layout">
                <div class="qr-box">
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data={{ request.url_root }}ho-so-y-te/{{ share_token }}" alt="QR Code" width="150" height="150">
                </div>

                <div class="qr-content">
                    <div class="share-status">
                        <span class="share-status-dot">‚óè</span>
                        <span>ƒêang chia s·∫ª c√¥ng khai</span>
                    </div>
                    
                    <p class="muted text-sm" style="line-height: 1.5; margin-bottom: 15px;">
                        Qu√©t m√£ b√™n c·∫°nh ho·∫∑c sao ch√©p ƒë∆∞·ªùng d·∫´n d∆∞·ªõi ƒë√¢y ƒë·ªÉ g·ª≠i cho b√°c sƒ©.<br>
                        B·∫•t k·ª≥ ai c√≥ ƒë∆∞·ªùng d·∫´n n√†y ƒë·ªÅu c√≥ th·ªÉ xem l·ªãch s·ª≠ kh√°m c·ªßa b·∫°n.
                    </p>
                    
                    <div>
                        <input type="text" class="qr-link-input"
                               value="{{ request.url_root }}ho-so-y-te/{{ share_token }}" 
                               readonly onclick="this.select()">
                    </div>

                    <form method="POST" action="{{ url_for('benh_nhan.tao_lien_ket_chia_se') }}">
                        <input type="hidden" name="hanh_dong" value="huy">
                        <button type="submit" class="btn btn-outline btn-sm" style="border-color: var(--red); color: var(--red);">
                            H·ªßy chia s·∫ª / V√¥ hi·ªáu h√≥a Link
                        </button>
                    </form>
                </div>
            </div>
        {% else %}
            <div class="text-center" style="padding: 20px 0;">
                <p class="muted mb-15">H·ªì s∆° c·ªßa b·∫°n hi·ªán t·∫°i l√† <strong>Ri√™ng t∆∞</strong>.</p>
                <form method="POST" action="{{ url_for('benh_nhan.tao_lien_ket_chia_se') }}">
                    <input type="hidden" name="hanh_dong" value="tao">
                    <button type="submit" class="btn btn-primary">
                        + T·∫°o m√£ chia s·∫ª ngay
                    </button>
                </form>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

====================
FILE: .\templates\quan_ly_lich_hen.html
====================
{% extends "base.html" %}

{% block title %}Qu·∫£n l√Ω l·ªãch h·∫πn{% endblock %}

{% block top_actions %}
  <div class="user-info">
      Xin ch√†o, <strong>{{ session.ho_ten }}</strong>
  </div>
  <a class="btn btn-danger" href="{{ url_for('auth.dang_xuat') }}">ƒêƒÉng xu·∫•t</a>
{% endblock %}

{% block content %}
<div class="card">
  <div class="card__header card__header--row">
    <div>
        <h1 class="h1">Danh s√°ch l·ªãch h·∫πn</h1>
        <p class="muted">Qu·∫£n l√Ω v√† duy·ªát l·ªãch kh√°m b·ªánh</p>
    </div>
  </div>

  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>M√£ s·ªë</th>
          <th>Th·ªùi gian</th>
          <th>B·ªánh nh√¢n</th>
          <th>Th√¥ng tin</th>
          {% if session.vai_tro == 'ADMIN' %}
            <th>B√°c sƒ© ph·ª• tr√°ch</th>
          {% endif %}
          <th>Tr·∫°ng th√°i</th>
          <th class="t-center">H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody>
        {% if ds_lich_hen %}
            {% for lh in ds_lich_hen %}
            <tr class="t-center">
              <td>{{ lh.LichHenID }}</td>
              <td>
                <div class="text-bold">{{ lh.GioKham }}</div>
                <div class="muted">{{ lh.NgayKham }}</div>
              </td>
              <td>
                <div class="text-bold">{{ lh.TenBenhNhan }}</div>
                <div class="text-sm muted">
                    {{ lh.GioiTinh }} - {{ lh.NgaySinh }}
                </div>
              </td>
              <td style="max-width: 200px;">
                {% if lh.LyDoKham %}
                    {{ lh.LyDoKham }}
                {% else %}
                    <span class="muted">-- Kh√¥ng c√≥ l√Ω do --</span>
                {% endif %}
              </td>
              
              {% if session.vai_tro == 'ADMIN' %}
                <td>{{ lh.TenBacSi }}</td>
              {% endif %}

              <td>
                <span class="badge badge--{{ lh.TrangThai }}">
                  {% if lh.TrangThai == 'CHO_XAC_NHAN' %} Ch·ªù x√°c nh·∫≠n
                  {% elif lh.TrangThai == 'DA_XAC_NHAN' %} ƒê√£ duy·ªát
                  {% elif lh.TrangThai == 'DA_KHAM' %} ƒê√£ kh√°m
                  {% elif lh.TrangThai == 'HUY' %} ƒê√£ h·ªßy
                  {% elif lh.TrangThai == 'VANG_MAT' %} V·∫Øng m·∫∑t 
                  {% else %} {{ lh.TrangThai }}
                  {% endif %}
                </span>
              </td>
              <td class="t-center">
                <div class="d-flex gap-5" style="justify-content: center;">
                    
                    {# N√∫t DUY·ªÜT #}
                    {% if lh.TrangThai == 'CHO_XAC_NHAN' %}
                    <form method="POST" action="{{ url_for('bac_si.cap_nhat_trang_thai', lich_hen_id=lh.LichHenID, trang_thai='DA_XAC_NHAN') }}">
                        <button type="submit" class="btn btn-primary btn-sm">Duy·ªát</button>
                    </form>
                    {% endif %}

                    {# N√∫t HO√ÄN TH√ÄNH ho·∫∑c V·∫ÆNG M·∫∂T #}
                    {% if lh.TrangThai == 'DA_XAC_NHAN' %}
                        <button type="button" 
                                class="btn btn-outline btn-sm" 
                                style="color: var(--green); border-color: var(--green);"
                                onclick="moFormKham('{{ lh.LichHenID }}', '{{ lh.TenBenhNhan }}')">
                            Kh√°m
                        </button>

                        <form method="POST" action="{{ url_for('bac_si.cap_nhat_trang_thai', lich_hen_id=lh.LichHenID, trang_thai='VANG_MAT') }}" onsubmit="return confirm('X√°c nh·∫≠n b·ªánh nh√¢n v·∫Øng m·∫∑t?');" style="display: inline;">
                            <button type="submit" class="btn btn-outline btn-sm" style="color: #475569; border-color: #cbd5e1;">
                                V·∫Øng m·∫∑t
                            </button>
                        </form>
                    {% endif %}
                    
                    {# N√∫t H·ª¶Y #}
                    {% if lh.TrangThai in ['CHO_XAC_NHAN', 'DA_XAC_NHAN'] %}
                    <form method="POST" action="{{ url_for('bac_si.cap_nhat_trang_thai', lich_hen_id=lh.LichHenID, trang_thai='HUY') }}" onsubmit="return confirm('B·∫°n ch·∫Øc ch·∫Øn mu·ªën h·ªßy l·ªãch n√†y?');">
                        <button type="submit" class="btn btn-ghost btn-sm" style="color: var(--red);">H·ªßy</button>
                    </form>
                    {% endif %}
                </div>
              </td>
            </tr>
            {% endfor %}
        {% else %}
            <tr>
                <td colspan="7" class="t-center muted" style="padding: 30px;">
                    Ch∆∞a c√≥ l·ªãch h·∫πn n√†o.
                </td>
            </tr>
        {% endif %}
      </tbody>
    </table>

    <div id="modalKham" class="modal">
      <div class="card modal-content">
          <span class="modal-close" onclick="dongModal()">&times;</span>
          
          <h2 class="h1 mb-15" style="font-size: 20px;">K·∫øt qu·∫£ kh√°m b·ªánh</h2>
          <p class="muted mb-20">Nh·∫≠p ch·∫©n ƒëo√°n v√† toa thu·ªëc cho b·ªánh nh√¢n: <strong id="modalTenBN"></strong></p>

          <form action="{{ url_for('bac_si.luu_ket_qua_kham') }}" method="POST">
              <input type="hidden" name="lich_hen_id" id="modalLichHenID">

              <div class="field">
                  <label class="label">Ch·∫©n ƒëo√°n / K·∫øt lu·∫≠n</label>
                  <textarea class="input" name="chan_doan" rows="3" required placeholder="V√≠ d·ª•: Vi√™m h·ªçng c·∫•p..."></textarea>
              </div>

              <div class="field">
                  <label class="label">Toa thu·ªëc / Ch·ªâ ƒë·ªãnh</label>
                  <textarea class="input" name="toa_thuoc" rows="4" required placeholder="V√≠ d·ª•: Panadol 500mg (2 vi√™n/ng√†y)..."></textarea>
              </div>

              <div class="d-flex gap-10 mt-15">
                  <button type="submit" class="btn btn-primary" style="flex: 1;">L∆∞u & Ho√†n th√†nh</button>
                  <button type="button" class="btn btn-outline" onclick="dongModal()" style="flex: 1;">ƒê√≥ng</button>
              </div>
          </form>
      </div>
  </div>

  <script>
      function moFormKham(id, tenBenhNhan) {
          document.getElementById('modalLichHenID').value = id;
          document.getElementById('modalTenBN').innerText = tenBenhNhan;
          document.getElementById('modalKham').style.display = 'block';
      }
      
      function dongModal() {
          document.getElementById('modalKham').style.display = 'none';
      }

      window.onclick = function(event) {
          if (event.target == document.getElementById('modalKham')) {
              dongModal();
          }
      }
  </script>
  </div>
</div>
{% endblock %}

====================
FILE: .\templates\thong_tin_phong_kham.html
====================
{% extends "base.html" %}

{% block title %}
Th√¥ng tin ph√≤ng kh√°m
{% endblock %}

{% block top_actions %}
  <a class="btn btn-ghost" href="{{ url_for('benh_nhan.trang_benh_nhan') }}">‚Üê Trang b·ªánh nh√¢n</a>
{% endblock %}

{% block content %}
<div class="grid-2">

  <div class="card">
    <div class="card__header">
      <h1 class="h1">Th√¥ng tin ph√≤ng kh√°m</h1>
      <p class="muted">Th√¥ng tin li√™n h·ªá v√† gi·ªù l√†m vi·ªác</p>
    </div>

    <div class="info">
      <div class="info__row">
        <span class="info__label">T√™n:</span>
        <span>{{ thong_tin.ten }}</span>
      </div>
      <div class="info__row">
        <span class="info__label">ƒê·ªãa ch·ªâ:</span>
        <span>{{ thong_tin.dia_chi }}</span>
      </div>
      <div class="info__row">
        <span class="info__label">S·ªë ƒëi·ªán tho·∫°i:</span>
        <span>{{ thong_tin.so_dien_thoai }}</span>
      </div>
      <div class="info__row">
        <span class="info__label">Gi·ªù l√†m vi·ªác:</span>
        <span>{{ thong_tin.gio_lam_viec }}</span>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card__header">
      <h1 class="h1">Danh s√°ch b√°c sƒ©</h1>
      <p class="muted">B√°c sƒ© hi·ªán c√≥ trong h·ªá th·ªëng</p>
    </div>

    {% if ds_bac_si %}
      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>M√£</th>
              <th>H·ªç t√™n</th>
              <th>Chuy√™n khoa</th>
              <th>Kinh nghi·ªám</th>
              <th>ƒê√°nh gi√°</th> <th>SƒêT</th>
            </tr>
          </thead>

          <tbody>
            {% for bs in ds_bac_si %}
              <tr>
                <td>{{ bs.BacSiID }}</td>
                <td>{{ bs.HoTen }}</td>
                <td>{{ bs.TenChuyenKhoa }}</td>
                <td>{{ bs.KinhNghiemNam }} nƒÉm</td>
                
                <td>
                  {% if bs.LuotDanhGia > 0 %}
                      <span style="color: #f59e0b; font-weight: bold;">{{ bs.DiemTrungBinh }} ‚≠ê</span>
                      <div class="muted" style="font-size: 11px;">({{ bs.LuotDanhGia }} l∆∞·ª£t)</div>
                  {% else %}
                      <span class="muted" style="font-size: 12px;">Ch∆∞a c√≥</span>
                  {% endif %}
                </td>

                <td>{{ bs.SoDienThoai }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="muted">Ch∆∞a c√≥ b√°c sƒ© n√†o.</p>
    {% endif %}
  </div>

</div>
{% endblock %}

====================
FILE: .\templates\trang_benh_nhan.html
====================
{% extends "base.html" %}

{% block title %}L·ªãch h·∫πn c·ªßa t√¥i{% endblock %}

{% block top_actions %}
  <a href="{{ url_for('benh_nhan.dat_lich') }}" class="btn btn-primary">ƒê·∫∑t l·ªãch</a>
  <a href="{{ url_for('auth.dang_xuat') }}" class="btn btn-outline">ƒêƒÉng xu·∫•t</a>
{% endblock %}

{% block content %}

{% if thong_bao_nhac_lich %}
<div class="alert-warning mb-20">
    <div class="d-flex gap-10 mb-15">
        <span style="font-size: 20px;">üîî</span>
        <strong>L·ªãch kh√°m s·∫Øp t·ªõi</strong>
    </div>
    <ul>
        {% for msg in thong_bao_nhac_lich %}
            <li>{{ msg }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<div class="grid-2 mb-20">
    
    <div class="card widget-card">
        <div class="widget-text">
            <h3 class="h1">Chia s·∫ª h·ªì s∆°</h3>
            <p>T·∫°o m√£ QR xem l·ªãch s·ª≠ kh√°m</p>
        </div>
        <a href="{{ url_for('benh_nhan.quan_ly_chia_se') }}" class="btn btn-outline btn-sm">
            Qu·∫£n l√Ω ‚Üí
        </a>
    </div>

    <div class="card widget-card">
        <form method="POST" action="{{ url_for('benh_nhan.xu_ly_cai_dat_thong_bao') }}" class="widget-form">
            <div class="widget-text">
                <h3 class="h1">Nh·∫Øc l·ªãch kh√°m</h3>
                <p>Nh·∫Øc tr∆∞·ªõc 24h</p>
            </div>
            
            <div class="d-flex gap-10">
                <span class="text-sm text-bold muted">
                    {{ 'B·∫¨T' if cai_dat_thong_bao == 1 else 'T·∫ÆT' }}
                </span>
                <label class="switch">
                    <input type="checkbox" name="nhan_thong_bao" onchange="this.form.submit()" 
                           {% if cai_dat_thong_bao == 1 %}checked{% endif %}>
                    <span class="slider"></span>
                </label>
            </div>
        </form>
    </div>

</div>

<div class="card">
  <div class="card__header card__header--row">
    <div>
      <h1 class="h1">L·ªãch h·∫πn c·ªßa t√¥i</h1>
      <p class="muted">Danh s√°ch c√°c l·ªãch kh√°m b·∫°n ƒë√£ ƒë·∫∑t</p>
    </div>

    <a href="{{ url_for('public.thong_tin_phong_kham') }}" class="btn btn-ghost">
      Th√¥ng tin ph√≤ng kh√°m
    </a>
  </div>

  {% if lich_hen %}
    <div class="table-wrap">
      <table class="table">
        <thead>
          <tr class="t-center">
            <th>B√°c sƒ©</th>
            <th>Ng√†y</th>
            <th>Gi·ªù</th>
            <th>Tr·∫°ng th√°i</th>
            <th>Thao t√°c</th>
          </tr>
        </thead>
        <tbody>
        {% for lh in lich_hen %}
          <tr class="t-center">
            <td>{{ lh.TenBacSi }}</td>
            <td>{{ lh.NgayKham }}</td>
            <td>{{ lh.GioKham }}</td>
            <td>
              <span class="badge badge--{{ lh.TrangThai }}">
                {% if lh.TrangThai == 'CHO_XAC_NHAN' %} Ch·ªù x√°c nh·∫≠n
                {% elif lh.TrangThai == 'DA_XAC_NHAN' %} ƒê√£ x√°c nh·∫≠n
                {% elif lh.TrangThai == 'DA_KHAM' %} ƒê√£ kh√°m
                {% elif lh.TrangThai == 'HUY' %} ƒê√£ hu·ª∑
                {% elif lh.TrangThai == 'VANG_MAT' %} V·∫Øng m·∫∑t
                {% endif %}
              </span>
            </td>
            <td class="t-center">
              {% if lh.TrangThai in ['CHO_XAC_NHAN', 'DA_XAC_NHAN'] %}
                <form method="post" action="{{ url_for('benh_nhan.huy_lich', lich_hen_id=lh.LichHenID) }}"
                      onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën hu·ª∑ l·ªãch kh√°m n√†y?')" class="inline-form">
                  <button type="submit" class="btn btn-danger btn-sm">Hu·ª∑</button>
                </form>
              {% elif lh.TrangThai == 'DA_KHAM' %}
                {% if lh.SoSao %}
                    <span class="text-warning text-bold">{{ lh.SoSao }} ‚≠ê</span>
                {% else %}
                    <a href="{{ url_for('benh_nhan.danh_gia', lich_hen_id=lh.LichHenID) }}" 
                       class="btn btn-outline btn-sm" 
                       style="border-color: #f59e0b; color: #f59e0b;">
                       ƒê√°nh gi√°
                    </a>
                {% endif %}
              {% else %}
                  <span class="muted">-</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="muted">B·∫°n ch∆∞a c√≥ l·ªãch h·∫πn n√†o.</p>
  {% endif %}

</div>
{% endblock %}
