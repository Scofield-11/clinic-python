{% extends "base.html" %}

{% block title %}
L·ªãch h·∫πn c·ªßa t√¥i
{% endblock %}

{% block top_actions %}
  <a href="{{ url_for('dat_lich') }}" class="btn btn-primary">ƒê·∫∑t l·ªãch</a>
  <a href="{{ url_for('dang_xuat') }}" class="btn btn-outline">ƒêƒÉng xu·∫•t</a>
{% endblock %}

{% block content %}
{% if thong_bao_nhac_lich %}
<div class="alert" style="background-color: #fffbeb; border: 1px solid #fcd34d; color: #92400e; margin-bottom: 20px;">
    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
        <span style="font-size: 20px;">üîî</span>
        <strong>L·ªãch kh√°m s·∫Øp t·ªõi</strong>
    </div>
    <ul style="margin: 0; padding-left: 24px;">
        {% for msg in thong_bao_nhac_lich %}
            <li style="margin-bottom: 4px;">{{ msg }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<div class="card" style="margin-bottom: 20px; padding: 15px 20px;">
    <form method="POST" action="{{ url_for('xu_ly_cai_dat_thong_bao') }}" style="display: flex; align-items: center; justify-content: space-between;">
        
        <div>
            <h3 class="h1" style="font-size: 16px; margin-bottom: 4px;">Th√¥ng b√°o nh·∫Øc l·ªãch</h3>
            <p class="muted" style="margin: 0; font-size: 13px;">Nh·∫≠n nh·∫Øc nh·ªü tr√™n web tr∆∞·ªõc gi·ªù kh√°m 24 ti·∫øng.</p>
        </div>
        
        <div style="display: flex; align-items: center; gap: 12px;">
            <span style="font-size: 13px; font-weight: 600; color: var(--text-muted);">
                {{ 'ƒêANG B·∫¨T' if cai_dat_thong_bao == 1 else 'ƒêANG T·∫ÆT' }}
            </span>
            
            <label class="switch">
                <input type="checkbox" name="nhan_thong_bao" onchange="this.form.submit()" 
                       {% if cai_dat_thong_bao == 1 %}checked{% endif %}>
                <span class="slider round"></span>
            </label>
        </div>

    </form>
</div>
<div class="card">

  <div class="card__header card__header--row">
    <div>
      <h1 class="h1">L·ªãch h·∫πn c·ªßa t√¥i</h1>
      <p class="muted">Danh s√°ch c√°c l·ªãch kh√°m b·∫°n ƒë√£ ƒë·∫∑t</p>
    </div>

    <a href="{{ url_for('thong_tin_phong_kham') }}" class="btn btn-ghost">
      Th√¥ng tin ph√≤ng kh√°m
    </a>
  </div>

  {% if lich_hen %}
    <div class="table-wrap">
      <table class="table">
        <thead>
          <tr class="t-center">
            <th>B√°c sƒ©</th>
            <th>Ng√†y</th>
            <th>Gi·ªù</th>
            <th>Tr·∫°ng th√°i</th>
            <th>Thao t√°c</th>
          </tr>
        </thead>

        <tbody>
        {% for lh in lich_hen %}
          <tr class="t-center">
            <td>{{ lh.TenBacSi }}</td>
            <td>{{ lh.NgayKham }}</td>
            <td>{{ lh.GioKham }}</td>
            <td>
              <span class="badge badge--{{ lh.TrangThai }}">
                {% if lh.TrangThai == 'CHO_XAC_NHAN' %}
                  Ch·ªù x√°c nh·∫≠n
                {% elif lh.TrangThai == 'DA_XAC_NHAN' %}
                  ƒê√£ x√°c nh·∫≠n
                {% elif lh.TrangThai == 'DA_KHAM' %}
                  ƒê√£ kh√°m
                {% elif lh.TrangThai == 'HUY' %}
                  ƒê√£ hu·ª∑
                {% elif lh.TrangThai == 'VANG_MAT' %} 
                  V·∫Øng m·∫∑t
                {% endif %}
              </span>
            </td>
            <td class="t-center">
              {% if lh.TrangThai in ['CHO_XAC_NHAN', 'DA_XAC_NHAN'] %}
                <form
                  method="post"
                  action="{{ url_for('huy_lich', lich_hen_id=lh.LichHenID) }}"
                  onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën hu·ª∑ l·ªãch kh√°m n√†y?')"
                  class="inline-form"
                >
                  <button type="submit" class="btn btn-danger">
                    Hu·ª∑
                  </button>
                </form>
              {% elif lh.TrangThai == 'DA_KHAM' %}
                {% if lh.SoSao %}
                    <span style="color: #f59e0b; font-weight: bold;">
                        {{ lh.SoSao }} ‚≠ê
                    </span>
                {% else %}
                    <a href="{{ url_for('danh_gia', lich_hen_id=lh.LichHenID) }}" 
                       class="btn btn-outline" 
                       style="padding: 6px 12px; font-size: 12px; border-color: #f59e0b; color: #f59e0b;">
                       ƒê√°nh gi√°
                    </a>
                {% endif %}
              
              {% else %}
                <span class="muted">-</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="muted">B·∫°n ch∆∞a c√≥ l·ªãch h·∫πn n√†o.</p>
  {% endif %}

</div>
{% endblock %}
