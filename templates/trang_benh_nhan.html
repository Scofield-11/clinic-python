{% extends "base.html" %}

{% block title %}L·ªãch h·∫πn c·ªßa t√¥i{% endblock %}

{% block top_actions %}
  <a href="{{ url_for('benh_nhan.dat_lich') }}" class="btn btn-primary">ƒê·∫∑t l·ªãch</a>
  <a href="{{ url_for('auth.dang_xuat') }}" class="btn btn-outline">ƒêƒÉng xu·∫•t</a>
{% endblock %}

{% block content %}

{% if thong_bao_nhac_lich %}
<div class="alert-warning mb-20">
    <div class="d-flex gap-10 mb-15">
        <span style="font-size: 20px;">üîî</span>
        <strong>L·ªãch kh√°m s·∫Øp t·ªõi</strong>
    </div>
    <ul>
        {% for msg in thong_bao_nhac_lich %}
            <li>{{ msg }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<div class="grid-2 mb-20">
    
    <div class="card widget-card">
        <div class="widget-text">
            <h3 class="h1">Chia s·∫ª h·ªì s∆°</h3>
            <p>T·∫°o m√£ QR xem l·ªãch s·ª≠ kh√°m</p>
        </div>
        <a href="{{ url_for('benh_nhan.quan_ly_chia_se') }}" class="btn btn-outline btn-sm">
            Qu·∫£n l√Ω ‚Üí
        </a>
    </div>

    <div class="card widget-card">
        <form method="POST" action="{{ url_for('benh_nhan.xu_ly_cai_dat_thong_bao') }}" class="widget-form">
            <div class="widget-text">
                <h3 class="h1">Nh·∫Øc l·ªãch kh√°m</h3>
                <p>Nh·∫Øc tr∆∞·ªõc 24h</p>
            </div>
            
            <div class="d-flex gap-10">
                <span class="text-sm text-bold muted">
                    {{ 'B·∫¨T' if cai_dat_thong_bao == 1 else 'T·∫ÆT' }}
                </span>
                <label class="switch">
                    <input type="checkbox" name="nhan_thong_bao" onchange="this.form.submit()" 
                           {% if cai_dat_thong_bao == 1 %}checked{% endif %}>
                    <span class="slider"></span>
                </label>
            </div>
        </form>
    </div>

</div>

<div class="card">
  <div class="card__header card__header--row">
    <div>
      <h1 class="h1">L·ªãch h·∫πn c·ªßa t√¥i</h1>
      <p class="muted">Danh s√°ch c√°c l·ªãch kh√°m b·∫°n ƒë√£ ƒë·∫∑t</p>
    </div>

    <a href="{{ url_for('public.thong_tin_phong_kham') }}" class="btn btn-ghost">
      Th√¥ng tin ph√≤ng kh√°m
    </a>
  </div>

  {% if lich_hen %}
    <div class="table-wrap">
      <table class="table">
        <thead>
          <tr class="t-center">
            <th>B√°c sƒ©</th>
            <th>Ng√†y</th>
            <th>Gi·ªù</th>
            <th>Tr·∫°ng th√°i</th>
            <th>Thao t√°c</th>
          </tr>
        </thead>
        <tbody>
        {% for lh in lich_hen %}
          <tr class="t-center">
            <td>{{ lh.TenBacSi }}</td>
            <td>{{ lh.NgayKham }}</td>
            <td>{{ lh.GioKham }}</td>
            <td>
              <span class="badge badge--{{ lh.TrangThai }}">
                {% if lh.TrangThai == 'CHO_XAC_NHAN' %} Ch·ªù x√°c nh·∫≠n
                {% elif lh.TrangThai == 'DA_XAC_NHAN' %} ƒê√£ x√°c nh·∫≠n
                {% elif lh.TrangThai == 'DA_KHAM' %} ƒê√£ kh√°m
                {% elif lh.TrangThai == 'HUY' %} ƒê√£ hu·ª∑
                {% elif lh.TrangThai == 'VANG_MAT' %} V·∫Øng m·∫∑t
                {% endif %}
              </span>
            </td>
            <td class="t-center">
              {% if lh.TrangThai in ['CHO_XAC_NHAN', 'DA_XAC_NHAN'] %}
                <form method="post" action="{{ url_for('benh_nhan.huy_lich', lich_hen_id=lh.LichHenID) }}"
                      onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën hu·ª∑ l·ªãch kh√°m n√†y?')" class="inline-form">
                  <button type="submit" class="btn btn-danger btn-sm">Hu·ª∑</button>
                </form>
              {% elif lh.TrangThai == 'DA_KHAM' %}
                {% if lh.SoSao %}
                    <span class="text-warning text-bold">{{ lh.SoSao }} ‚≠ê</span>
                {% else %}
                    <a href="{{ url_for('benh_nhan.danh_gia', lich_hen_id=lh.LichHenID) }}" 
                       class="btn btn-outline btn-sm" 
                       style="border-color: #f59e0b; color: #f59e0b;">
                       ƒê√°nh gi√°
                    </a>
                {% endif %}
              {% else %}
                  <span class="muted">-</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="muted">B·∫°n ch∆∞a c√≥ l·ªãch h·∫πn n√†o.</p>
  {% endif %}

</div>
{% endblock %}